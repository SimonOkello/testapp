{% extends 'base.html' %}
{% load static %}
{% block title %}Quiz Details{% endblock title %}

{% block content %}
{{obj.name}}
<hr>
<form id="quiz-form" class="mt-3 mb-3">
{% csrf_token %}
<div id="quiz-box"></div>
<button type="submit" class="btn btn-primary mt-3">Save</button>
</form>

{% block scripts %}
    <script>
    const url = window.location.href
    const quizBox = document.getElementById("quiz-box")
    $.ajax({
        type: 'GET',
        url: `${url}data`,
        success: function(response){
            const data = response.data
            data.forEach(el =>{
                for(const [question, answers] of Object.entries(el)){
                    quizBox.innerHTML+=`
                        <hr>
                        <div class="mb-2">
                            <br>${question}</br>
                        </div>
                    `
                    answers.forEach(answer =>{
                        quizBox.innerHTML+=`
                        <div>
                        <input type="radio" class="ans" id="${question}-${answer}" name="${question}" value="${answer}">
                        <label for="${question}">${answer}</label>
                        </div>
                    `
                    })

                }
            });


        },
        error: function(error){
            console.log(error)
        },

    })
    const quizForm = document.getElementById("quiz-form")
    const csrf = document.getElementsByName("csrfmiddlewaretoken")
    const elements = [...document.getElementsByClassName('ans')]

    const sendData =  () =>{
        const data = {}
        data['csrfmiddlewaretoken']=csrf[0].value
        elements.forEach(el=>{
            if(el.checked){
                data[el.name]= el.value
            }else{
                if(!data[el.name]){
                    data[el.name]=null
                }
            }
        })
        $.ajax({
            type: 'POST',
            url: `${url}save/`,
            data: data,
            success: function(response){
                console.log(response)
            },
            error: function(error){
                console.log(error)
            },
        })

    }
    quizForm.addEventListener('submit', e=>{
        e.preventDefault()
        sendData()
    })
    </script>
{% endblock scripts %}

{% endblock content %}